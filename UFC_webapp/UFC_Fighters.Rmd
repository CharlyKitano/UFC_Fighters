---
title: "UFC Fighters"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
resource_files:
- Final_data.csv
- Final_data.csv
- Final_data.csv
---



```{r setup, echo=FALSE}
library(shiny)
library(shinydashboard)
library(DT)
<<<<<<< HEAD
data <- read.csv("Final_data.csv") 
# UI code 
=======

# Load data
data <- read.csv("C:/Users/HP/Documents/EMA cours/projet visu/Final_data.csv")

# UI code
>>>>>>> 847fe8959298a23bc279fb1be39dcd49f99aae35
ui <- fluidPage(
  dashboardPage(
    dashboardHeader(title = "UFC"),
    dashboardSidebar(
      sidebarMenu(
        menuItem("General Info", tabName = "general_info"),
        menuItem("Comparison", tabName = "comparison")
      )
    ),
    dashboardBody(
      tabItems(
        tabItem(
          tabName = "general_info",
          fluidRow(
              box(
                title = "Filters",
                status = "primary",
                solidHeader = TRUE,
                collapsible = TRUE,
                width = 12,
                fluidRow(
                  column(12, textInput("country", "Country:", placeholder = "Enter country")),
                  column(12, selectInput("fighting_style", "Fighting Style:",
                                        choices = unique(data$Fighting.style),
                                        selected = "KICKBOXER")),
                  column(12, textInput("age", "Age:", placeholder = "Enter age")),
                  column(12, selectInput("weight_class", "Weight Class:",
                                        choices = c("Light Weight", "Female"))),
                  column(12, selectInput("gender", "Gender:",
                                        choices = c("Male", "Female")
                                       )
                  
                  )
                ),
                actionButton("get_results", "Get Results", class = "btn-primary")
              )
            ),
          fluidRow(
            column(12, DTOutput("placeholder_table"))
          )
        ),
        tabItem(
          tabName = "comparison",
          fluidRow(
            box(
              title = "Player Comparison",
              status = "warning",
              solidHeader = TRUE,
              collapsible = TRUE,
              fluidRow(
                column(6, textInput("player1", "Player 1:", placeholder = "Enter name")),
                column(6, textInput("player2", "Player 2:", placeholder = "Enter name"))
              ),
              actionButton("compare_players", "Compare Players", class = "btn-warning")
            ),
            box(
              title = "Player Info",
              status = "primary",
              solidHeader = TRUE,
              collapsible = TRUE,
              textInput("player_info", "Player Info:", placeholder = "Enter name"),
              actionButton("generate", "Generate Info")
            ),
            fluidRow(
              column(12, tableOutput("player_info_table"), align = "center")
            ),
            #think about adding a fluid row here to have them side by side or create uiOutput that has both of them 
            #think also of checking the column size
             fluidRow(
       uiOutput("player_charts_ui"),  
       uiOutput("player_values_ui")   
    )
           
          )
        )
      )
    )
  )
)


# Server code
server <- function(input, output, session) {
  output$placeholder_table <- renderDT({
    req(input$get_results)
    # data <- data.frame(
    #   Test = c("Test", "Test", "Test"),
    #   Age = c(30, 25, 35),
    #   Test = c("Test", "Test", "Test")
    # )
    # datatable(data)
    if (!is.null(input$country) && !is.null(input$age)) {
       # Based on the provided inputs, generate or filter the datatable
        
        # input$country = "Kazakhstan"
        # input$age = 33
       filtered_data <- data[data["Place.of.Birth"] == input$country & data$Age == input$age,,drop=FALSE]
       print(filtered_data)
      return(datatable(filtered_data))  # Render the datatable with the filtered data
    }

  })
  output$player_info_table <- renderTable({
    req(input$generate)
    
    player_info <- data[data$Name == input$player_info, c(
      "Wins.by.Knockout", 
      "Wins.by.Submission", 
      "Wins.by.Decision"
    )]
    
    player_info
  })
   output$player_charts_ui <- renderUI({
    req(input$generate)
    
                     tabBox(
                       title = "",
                       id = "player_charts",
                       tabPanel("Strike Percentages", 
                                plotOutput("strike_percentages_pie")),
                       tabPanel("Distribution of strikes by position", 
                                plotOutput("placeholder_plot"))
                       
                     
              
            )
     
     })
output$player_values_ui <- renderUI({
  req(input$generate)
  player_values <- data[data$Name == input$player_info, c( 
    "Sig..Str..Defense",
    "Takedown.Defense",
    "Knockdown.Avg",
    "Average.fight.time",
    "Takedown.Accuracy"
    
  )]
  takedown_accuracy <- as.numeric( input$player_values$Takedown.Accuracy)
  player_values$Takedown.Accuracy[is.na(player_values$Takedown.Accuracy)] <- 0
  fluidRow(
  #box(
   # background = "light-blue",
    #"Significant Strikes Defense: ", player_values$Sig..Str..Defense,br(),
    #"Takedown Defense:", player_values$Takedown.Defense,br(),
    #"Knockdown Avg:", player_values$Knockdown.Avg,br(),
    #"Average Fight Time: ", player_values$Average.fight.time
  #),
   valueBox(width = 3,
      paste0(player_values$Knockdown.Avg), "Knockdown avg", icon = icon("skull"),
      color = "orange"
    ),
  valueBox(width = 3,
      paste0( player_values$Average.fight.time, "min"), "Avg fight time", icon = icon("hand-fist"),
      color = "orange"
    )
  ,
   valueBox(width = 3,
      paste0(player_values$Takedown.Defense), "Takedown defense", icon = icon("shield"),
      color = "blue"
    ),
   valueBox(width = 3,
      paste0(player_values$Sig..Str..Defense, "%"), "Sig str defense", 
      color = "blue"
    )
  
  
  )
  
  
})
  output$placeholder_plot <- renderPlot({
    req(input$generate)  # Wait for the button to be clicked
    
    # Filter data based on the player's name
    player_data <- data[data$Name == input$player_info, ]
    columns_of_interest <- c("Sig..Str..By.Position...Standing", 
                             "Sig..Str..By.Position...Clinch", 
                             "Sig..Str..By.Position...Ground")
    pie_data <- player_data[, columns_of_interest]
    percentages <- colSums(pie_data) / sum(colSums(pie_data))
    custom_labels <- paste0(
      c("Standing", "Clinch", "Ground"), 
      ": ", 
      scales::percent(percentages)
    )
    pie(percentages, labels = custom_labels, main = "Distribution of Strikes by Position")
  })
  
  output$strike_percentages_pie <- renderPlot({
    req(input$generate)  # Only display after clicking "Generate Info" button
    #error in generating if textfield is empty 
    
    player_data <- data[data$Name == input$player_info, ]
    if (nrow(player_data) > 0) {
      # Fetch strike percentages from data
      strike_percentages <- c(
        player_data$Head...Pourcentage, 
        player_data$Body...Pourcentage, 
        player_data$Leg...Pourcentage
      )
      
      # Create custom labels with percentages
      custom_labels <- paste0(
        c("Head", "Body", "Leg"), 
        ": ", 
        strike_percentages, "%"
      )
      
      # Create pie plot
      pie(strike_percentages, labels = custom_labels, main = "Strike Percentages")
    } else {
      HTML("Player not found.")
    }
  })
}

# Run the Shiny app
shinyApp(ui = ui, server = server)



```
